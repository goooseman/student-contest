!function(a){function b(a,b){this.x=a,this.y=b}function c(a,b){this.point=a,this.timestamp=b}function d(b){return this.each(function(){b&&a.extend(l,b);var c=a(this),d={options:b,_currSpeed:0,_updateSpeedTimeout:null,_lastMousePos:null,_currMousePos:null,_hasAttachedMousemoveEvent:!1};c.data(j,d),c.mouseenter(e),c.mouseleave(f),g.apply(this)})}function e(){var b=a(this),c=b.data(j),d=c._currMousePos,f=c._lastMousePos,g=0;if(d&&f){var i=h(d.point,f.point);g=i/(d.timestamp-f.timestamp)}var k=c._currSpeed=g;c.options.onUpdateSpeed&&c.options.onUpdateSpeed.apply(b[0],[k]),c._updateSpeedTimeout=setTimeout(function(){e.apply(b[0])},c.options.speedPollingRate)}function f(){var b=a(this),c=b.data(j);c._currSpeed=0,c._lastMousePosCalc=null,c._currMousePosCalc=null,c._hasAttachedMousemoveEvent=!1,c._updateSpeedTimeout&&clearTimeout(c._updateSpeedTimeout)}function g(){var d=a(this),e=d.data(j);e._hasAttachedMousemoveEvent||(d.one("mousemove."+j,function(a){e._currMousePos&&(e._lastMousePos=e._currMousePos);var f=a.pageX,h=a.pageY,i=new b(f,h);e._currMousePos=new c(i,(new Date).getTime()),setTimeout(function(){g.apply(d[0])},e.options.captureMouseMoveRate),e._hasAttachedMousemoveEvent=!1}),e._hasAttachedMousemoveEvent=!0)}function h(a,b){var c=0;if(a&&b){var d=Math.pow(a.x-b.x,2),e=Math.pow(a.y-b.y,2);c=Math.sqrt(d+e)}return c}function i(){return a(this).data(j)._currSpeed}var j="cursometer",k={init:d,getCurrentSpeed:i},l={updateSpeedRate:20,captureMouseMoveRate:15,onUpdateSpeed:a.noop};a.fn.cursometer=function(b){return k[b]?k[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.cursometer"):k.init.apply(this,arguments)}}(jQuery),angular.module("mouseMoveSpeedApp",["ngResource","ui.bootstrap"]),angular.module("mouseMoveSpeedApp").controller("MainCtrl",["$scope","$timeout",function(a,b){function c(a){return a*Math.PI/180}function d(a,b){a.ctx.beginPath(),a.ctx.globalAlpha=b.alpha,a.ctx.lineWidth=b.lineWidth,a.ctx.fillStyle=b.fillStyle,a.ctx.strokeStyle=b.fillStyle,a.ctx.moveTo(b.from.X,b.from.Y),a.ctx.lineTo(b.to.X,b.to.Y),a.ctx.stroke()}function e(a,b,c,d,e,f,g){return{from:{X:a,Y:b},to:{X:c,Y:d},fillStyle:e,lineWidth:f,alpha:g}}function f(a){var b=0;for(a.ctx.globalAlpha=.2,a.ctx.fillStyle="rgb(0,0,0)",b=170;180>b;b++)a.ctx.beginPath(),a.ctx.arc(a.center.X,a.center.Y,b,0,Math.PI,!0),a.ctx.fill()}function g(a){a.ctx.lineWidth=2,a.ctx.globalAlpha=.5,a.ctx.strokeStyle="rgb(255, 255, 255)",a.ctx.fillStyle="rgb(255,255,255)"}function h(a){var b,f,h,i,j,k,l,m,n,o=a.levelRadius-8,p=0,q=a.gaugeOptions,r=0;for(g(a),p=10;180>p;p+=20)r=c(p),b=q.radius-Math.cos(r)*o,f=q.radius-Math.sin(r)*o,h=q.radius-Math.cos(r)*q.radius,i=q.radius-Math.sin(r)*q.radius,j=a.center.X-q.radius+b,k=q.center.Y-q.radius+f,m=a.center.X-q.radius+h,n=q.center.Y-q.radius+i,l=e(j,k,m,n,"rgb(127,127,127)",3,.6),d(a,l)}function i(a){var b,f,h,i,j,k,l,m,n,o=a.levelRadius-8,p=0,q=a.gaugeOptions,r=0;for(g(a),o=a.levelRadius-2,p=20;180>p;p+=20)r=c(p),h=q.radius-Math.cos(r)*o,i=q.radius-Math.sin(r)*o,f=q.radius-Math.cos(r)*q.radius,b=q.radius-Math.sin(r)*q.radius,j=a.center.X-q.radius+h,k=q.center.Y-q.radius+i,l=a.center.X-q.radius+f,m=q.center.Y-q.radius+b,n=e(j,k,l,m,"rgb(127,127,127)",3,.6),d(a,n)}function j(a){h(a),i(a)}function k(a){var b=0,d=0,e=0,f=a.gaugeOptions,h=0;for(g(a),a.ctx.font="italic 10px sans-serif",a.ctx.textBaseline="top",a.ctx.beginPath(),e=10;180>e;e+=20)b=f.radius-Math.cos(c(e))*f.radius,d=f.radius-Math.sin(c(e))*f.radius,10>=e?a.ctx.fillText(h,a.center.X-f.radius-12+b,f.center.Y-f.radius-12+d+5):50>e?a.ctx.fillText(h,a.center.X-f.radius-12+b-5,f.center.Y-f.radius-12+d+5):90>e?a.ctx.fillText(h,a.center.X-f.radius-12+b,f.center.Y-f.radius-12+d):90===e?a.ctx.fillText(h,a.center.X-f.radius-12+b+4,f.center.Y-f.radius-12+d):145>e?a.ctx.fillText(h,a.center.X-f.radius-12+b+10,f.center.Y-f.radius-12+d):a.ctx.fillText(h,a.center.X-f.radius-12+b+15,f.center.Y-f.radius-12+d+5),h+=10;a.ctx.stroke()}function l(a,b,c,d){a.ctx.beginPath(),a.ctx.globalAlpha=b,a.ctx.lineWidth=5,a.ctx.strokeStyle=c,a.ctx.arc(a.center.X,a.center.Y,a.levelRadius,Math.PI+Math.PI/360*d,0-Math.PI/360*10,!1),a.ctx.stroke()}function m(a){var b=10,c=200,d=280;l(a,1,"rgb(227, 227, 227)",b),l(a,.9,"rgb(153, 153, 153)",c),l(a,.9,"rgb(217, 83, 79)",d)}function n(a,b,c,d){var e=0;for(a.ctx.globalAlpha=b,a.ctx.lineWidth=3,a.ctx.strokeStyle=c,a.ctx.fillStyle=d,e=0;30>e;e++)a.ctx.beginPath(),a.ctx.arc(a.center.X,a.center.Y,e,0,Math.PI,!0),a.ctx.fill(),a.ctx.stroke()}function o(a){var b=a.speed/10,c=(20*b+10)%180;return c>180?c-=180:0>c&&(c+=180),c}function p(a){var b=o(a),f=c(b),g=a.gaugeOptions,h=g.radius-20*Math.cos(f),i=g.radius-20*Math.sin(f),j=a.center.X-g.radius+h,k=g.center.Y-g.radius+i,l=g.radius-Math.cos(f)*g.radius,m=g.radius-Math.sin(f)*g.radius,p=a.center.X-g.radius+l,q=g.center.Y-g.radius+m,r=e(j,k,p,q,"rgb(255,0,0)",5,.6);d(a,r),n(a,.6,"rgb(127, 127, 127)","rgb(255,255,255)"),n(a,.2,"rgb(127, 127, 127)","rgb(127,127,127)")}function q(a,b){var c=210,d=210,e=140,f=200;return{ctx:a.getContext("2d"),speed:b,center:{X:c,Y:d},levelRadius:e-10,gaugeOptions:{center:{X:c,Y:d},radius:e},radius:f}}function r(a){a.ctx.clearRect(0,0,800,600),g(a)}a.speed=0,a.maxSpeed=0,a.gameDuration=15,a.roundTime=!1;var s=40,t=20,u=null,v=null;a.draw=function(){var a=document.getElementById("speedometer-canvas"),b=null;return null!==a&&a.getContext?(b=q(a,s),r(b),f(b),j(b),k(b),m(b),p(b)):alert("Canvas not supported by your browser!"),t==s?void clearTimeout(v):(s>t?u=!0:t>s&&(u=!1),void(u?s-=t>s-10?1:5:s+=s+10>t?1:5))},a.startGame=function(c){function d(){return a.secondsLeft=a.secondsLeft-1,a.secondsLeft<=0?void clearInterval(e):void 0}a.secondsLeft=c;var e=setInterval(d,1e3);a.roundTime=!0,$(".game-controls").cursometer({onUpdateSpeed:function(b){a.speed>a.maxSpeed&&(a.maxSpeed=a.speed),s=b,a.draw(),a.speed=b,a.$apply()},updateSpeedRate:1e3}),$(".game-controls").mouseleave(function(){a.maxSpeed=0}),b(function(){a.roundTime=!1,$(".game-controls").cursometer().stopPolling(),a.$apply()},1e3*c)},$(document).ready(function(){s=0,a.draw()})}]);